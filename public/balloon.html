<!DOCTYPE html> 
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Balloon Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.1.9/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.3/socket.io.js"></script>
  </head>

  <body>
    <h1>ã‚¹ãƒãƒ›ã‚’å‚¾ã‘ã¦é¢¨èˆ¹ã‚’é£›ã°ãã†ğŸˆ</h1>
    <div>
      <div>ã‚ãªãŸã®ID: <span id="myid"></span></div>
      <button id="connect">ãƒ«ãƒ¼ãƒ ã«å…¥ã‚‹</button>
    </div>

    <script>
      let socket = io.connect();

      // ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿
      let beta = 0;  // å‰å¾Œï¼ˆä¸Šä¸‹ï¼‰
      let gamma = 0; // å·¦å³

      // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID
      let myid = sessionStorage.getItem("clientId");
      if (!myid) {
        myid = Math.random().toString(36).substring(2, 15);
        sessionStorage.setItem("clientId", myid);
      }
      document.querySelector("#myid").innerHTML = myid;

      // ãƒ«ãƒ¼ãƒ å‚åŠ 
      document.querySelector("#connect").addEventListener("click", function () {
        socket.emit("join", "game");
        this.remove();
      });

      // ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿å—ä¿¡
      socket.on("sensor", function (data) {
        beta = parseFloat(data.b);
        gamma = parseFloat(data.g);
      });

      // --- p5.jsæç”» ---
      let x = 0;
      let y = 300;
      let vy = 0;
      let gravity = 0.2;
      let liftPower = 0.3;

      // éšœå®³ç‰©
      const obstacles = [
        { x: -100, y: 150 },
        { x:  80, y: -50 },
        { x: -50, y: -200 },
        { x: 120, y: 50 }
      ];
      const spikeSize = 40;

      let gameOver = false;
      let explodeFrame = 0;

      function setup() {
        createCanvas(400, 600);
        noStroke();
        textAlign(CENTER);
      }

      function draw() {
        background(135, 206, 235); // ç©ºè‰²

        // === GAME OVERå¾Œã®è¡¨ç¤º ===
        if (gameOver) {
          if (explodeFrame < 30) {
            // å‰²ã‚Œã‚‹èµ¤ä¸¸æ¼”å‡º
            fill(255, 50, 50);
            let size = map(explodeFrame, 0, 30, 60, 200);
            ellipse(width/2 + x, height/2 + y, size, size);
            explodeFrame++;
          } else {
            // GAME OVERè¡¨ç¤º
            fill(255, 0, 0);
            textSize(50);
            text("GAME OVER", width/2, height/2);
          }
          return; // â†æ­¢ã‚ã‚‹
        }

        // å·¦å³ç§»å‹•
        x += gamma * 0.2;

        // ä¸Šä¸‹åˆ¶å¾¡
        let tilt = beta / 90;
        vy -= tilt * liftPower;
        vy += gravity;
        vy *= 0.95;
        y += vy;

        // ç”»é¢ç«¯åˆ¶é™
        x = constrain(x, -width/2 + 30, width/2 - 30);
        y = constrain(y, -height/2 + 40, height/2 - 40);

        // ä¸­å¿ƒåŸºæº–ã§æç”»
        push();
        translate(width/2, height/2);

        // --- éšœå®³ç‰©æç”»ï¼ˆèµ¤ã¨ã‚“ãŒã‚Šï¼‰ ---
        fill(255, 120, 120);
        for (let obs of obstacles) {
          triangle(
            obs.x - spikeSize/2, obs.y + spikeSize/2,
            obs.x + spikeSize/2, obs.y + spikeSize/2,
            obs.x, obs.y - spikeSize/2
          );

          // å½“ãŸã‚Šåˆ¤å®šï¼ˆå††ã¨ä¸‰è§’â†’ç°¡æ˜“è·é›¢åˆ¤å®šï¼‰
          let d = dist(x, y, obs.x, obs.y);
          if (d < 50) {
            gameOver = true;
          }
        }

        // é¢¨èˆ¹
        fill(255, 80, 80);
        ellipse(x, y, 60, 80);

        // ç´
        stroke(100);
        line(x, y + 40, x, y + 100);

        pop();

        // èª¬æ˜
        noStroke();
        fill(0);
        textSize(15);
        text("ã‚¹ãƒãƒ›ã‚’å‰ã«å‚¾ã‘ã‚‹ã¨ä¸Šã€å¾Œã‚ã§ä¸‹ã«å‹•ãã‚ˆï¼", width/2, 30);
      }
    </script>
  </body>
</html>




<!-- <!DOCTYPE html> 
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Balloon Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.1.9/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.3/socket.io.js"></script>
  </head>

  <body>
    <h1>ã‚¹ãƒãƒ›ã‚’å‚¾ã‘ã¦é¢¨èˆ¹ã‚’é£›ã°ãã†ğŸˆ</h1>
    <div>
      <div>ã‚ãªãŸã®ID: <span id="myid"></span></div>
      <button id="connect">ãƒ«ãƒ¼ãƒ ã«å…¥ã‚‹</button>
    </div>

    <script>
      let socket = io.connect();

      // ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿
      let beta = 0;  // å‰å¾Œ
      let gamma = 0; // å·¦å³

      // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID
      let myid = sessionStorage.getItem("clientId");
      if (!myid) {
        myid = Math.random().toString(36).substring(2, 15);
        sessionStorage.setItem("clientId", myid);
      }
      document.querySelector("#myid").innerHTML = myid;

      // ãƒ«ãƒ¼ãƒ å‚åŠ 
      document.querySelector("#connect").addEventListener("click", function () {
        socket.emit("join", "game");
        this.remove();
      });

      // ã‚»ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿å—ä¿¡
      socket.on("sensor", function (data) {
        beta = parseFloat(data.b);
        gamma = parseFloat(data.g);
      });

      // --- p5.jsæç”» ---
      let x = 0;
      let y = 300;
      let vy = 0;
      let gravity = 0.2;   // ä¸‹ã«è½ã¡ã‚‹åŠ›
      let liftPower = 0.3;  // å‰å‚¾ã§ä¸Šæ˜‡ã•ã›ã‚‹åŠ›

      // ãƒˆã‚²4ã¤ã®åº§æ¨™ï¼ˆä¸­å¿ƒåŸºæº–ï¼‰
      const spikes = [
        { x: -100, y: -100 },
        { x: 80,  y: -20 },
        { x: -50, y: 120 },
        { x: 100, y: 200 }
      ];

      function setup() {
        createCanvas(400, 600);
        noStroke();
        textAlign(CENTER);
      }

      function draw() {
        background(135, 206, 235); // ç©ºè‰²

        // å·¦å³ç§»å‹•
        x += gamma * 0.2;

        // ä¸Šä¸‹åˆ¶å¾¡
        let tilt = beta / 90;
        vy -= tilt * liftPower;
        vy += gravity;
        vy *= 0.95;
        y += vy;

        // ç”»é¢ç«¯åˆ¶é™
        x = constrain(x, -width/2 + 30, width/2 - 30);
        y = constrain(y, -height/2 + 40, height/2 - 40);

        // ä¸­å¿ƒåŸºæº–ã§æç”»
        push();
        translate(width/2, height/2);

        // ãƒˆã‚²æç”»
        fill(200, 50, 50);
        spikes.forEach(s => {
          triangle(
            s.x - 20, s.y + 20,
            s.x + 20, s.y + 20,
            s.x,     s.y - 20
          );
        });

        // é¢¨èˆ¹
        fill(255, 80, 80);
        ellipse(x, y, 60, 80);

        // ç´
        stroke(100);
        line(x, y + 40, x, y + 100);

        pop();

        // èª¬æ˜æ–‡
        noStroke();
        fill(0);
        textSize(15);
        text("ã‚¹ãƒãƒ›ã‚’å‰ã«å‚¾ã‘ã‚‹ã¨ä¸Šã«ã€å¾Œã‚ã«å‚¾ã‘ã‚‹ã¨ä¸‹ã«å‹•ãã‚ˆï¼", width/2, 30);
      }
    </script>
  </body>
</html> -->
